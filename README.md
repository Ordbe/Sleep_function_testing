### Описание
> Тестирование функции, вычисляющей продолжительность сна в приложении для мониторинга здоровья.
---
### Анализ требований
При анализе требований отсутствует информация по поводу того, как должен выглядеть результат, когда устройство зафиксировало сон несколько раз и между этими периодами прошло более часа. Можно было бы оформить баг-репорт, но неизвестны входные требования использования нескольких периодов сна. В остальном проверка охарактеризована ниже.

### План тестирования
В процессе ознакомления с требованиями было принято решение использовать метод разделения тестовых сценариев по классу эквивалентности и метод попарного тестирования. Таким образом, по классам эквивалентности (к.э.) были выделены следующие сценарии:
- разница между записями сна более 1 часа (к.э. 1.1);
- разница между записями сна менее 1 часа (к.э. 1.2);
- разница между записями сна 1 час (к.э. 1.3);
- в записях указан источник данных о сне, который был использован более 14 дней назад (к.э. 2.1);
- в записях указан источник данных о сне, который был использован менее 14 дней назад (к.э. 2.2);
- в записях указан источник данных о сне, который был использован 14 дней назад (к.э. 2.3);
- продолжительность сна более 17 часов (к.э. 3.1);
- продолжительность сна менее 17 часов (к.э. 3.2);
- продолжительность сна 17 часов (к.э. 3.3);
- записи в пределах 1 даты (к.э. 4.1);
- записи в пределах 2 дат (к.э. 4.2).
	
Эти 13 тестовых сценариев покроют основную часть работы функции анализа сна в пределах параметров, указанных в требованиях.

Для дополнения проверки сценариев, при которых ошибка может возникнуть из-за разницы входных значений по категориям begin/end/value/source дополнительно был применен метод попарного тестирования. Обозначить комбинации сценариев можно и вручную, но, во избежание погрешностей, был использован инструмент Pairwise Generator ресурса [Slothman](https://slothman.dev/pairwise-generator/). За входные значения использовались обозначенные выше классы эквивалентности, а за устройства - только данные Apple Health и Beddit, поэтому при увеличении количества устройств или изменении требований, учитываемых при проверке, следует заново сформировать комбинации для попарного тестирования. Входные данные для составления комбинаций тестов приведены в таблице: </br>
|Разница между записями сна|Последнее использование источника данных|Продолжительность сна|Кол-во дат в цикле сна|
|---|---|---|---|
|Более 1 часа|Более 14 дней назад|Более 17 часов|1 дата|
|Менее 1 часа|Менее 14 дней назад|Менее 17 часов|2 даты|
|Ровно час|Ровно 14 дней назад|Ровно 17 часов|-|
</br>
При таком формировании проверки вместо большого количества тест-кейсов возможно использование загружаемой в поле Link таблицы с записями о времени сна, составленной с учетом перечисленных сценариев, поэтому вместо тест-кейсов можно составить таблицу ожидаемых значений выполнения функции и при проверке проходить по определенным датам проверки. В этом случае его даже можно автоматизировать и, как следствие, минимизировать время, затрачиваемое на проверку функции анализа сна. таблица итоговых тестовых сценариев доступна по [ссылке](https://docs.google.com/spreadsheets/d/1uoiYuLhtsyPnv3hjAMYQz6fOZEJGmqGz_VjMfdBVxJE/edit#gid=0).

### Алгоритм тестирования
Для исчерпывающего тестового покрытия проверки функции анализа сна достаточно составить 10 тестовых сценариев, при этом данные сценарии будут однотипные и иметь зависимость лишь от вводимой даты, так как при составлении плана тестирования упор был сделан на разработку таблицы входных значений,  сформированной на основе тестовых сценариев в [таблице](https://docs.google.com/spreadsheets/d/1uoiYuLhtsyPnv3hjAMYQz6fOZEJGmqGz_VjMfdBVxJE/edit?usp=sharing).
	
Предусловием для прохождения сценариев являются следующие шаги:
- загрузить файл по [ссылке](https://www.dropbox.com/s/mmcqo10k6whhtef/Welltory_QA_test.ipynb?dl=0);
- открыть [ссылку](https://colab.research.google.com/);
- выбрать вкладку “Загрузить”;
- выбрать загруженный файл “Welltory_QA_test.ipnb”;
- скачать файл “Проверка функции анализа сна”  по [ссылке](https://docs.google.com/spreadsheets/d/1OCqHS_3V8NrL0InmuJwI5iZNZuefDYW5KyGE63CcZuc/edit?usp=sharing).
</br>
Таблица вводимой для проверки даты и ожидаемый результат выполнения функции доступен по [ссылке](https://docs.google.com/spreadsheets/d/1uoiYuLhtsyPnv3hjAMYQz6fOZEJGmqGz_VjMfdBVxJE/edit?usp=sharing).
</br>
Шаги для выполнения проверки:
- ввести значение даты из таблицы в поле “Date”;
- нажать “Get Result”;
- сверить полученный результат результатом в таблице и оформить баг-репорт в случае отклонения фактического результата от ожидаемого;
- повторить пункты 1-4 для следующего сценария.

### Итоги тестирования
В рамках заданных требованиями условий данная проверка покрывает достаточный объем тестовых сценариев. 
При изменении требований или используемых средств мониторинга сна следует пересмотреть план тестирования.
Обобщая, можно выделить следующий краткий порядок тестирования функции анализа сна:
- анализ требований;
- отбор параметров по классам эквивалентности;
- составление комбинаций для попарного тестирования;
- формирование таблицы данных о сне на основе комбинаций попарного тестирования;
- составление чек-листа ожидаемых результатов для сформированных тестовых сценариев;
- проверка всех пунктов по сценариям.

Была выполнена проверка по описанному выше плану тестирования, фактические результаты соответствуют ожидаемым, за исключением 1 случая (тестовый сценарий №9), сведения об ошибке в bug_report_1 по [ссылке](https://docs.google.com/spreadsheets/d/1XHViJFz7W1MCVAGegx8Hy004AM46BhAUisDun0GOP1E/edit?usp=sharing).
</br>
Блокирующая ошибка возникала при отсутствии источника данных в предыдущих записях, но баг-репорт будет не актуален, так как формирование базы данных о сне должно начинаться с момента начала использования самого приложения, поэтому даты до начала использования приложения логически не дадут полезной информации. В связи с этим для прохождения позитивных сценариев были дополнительно созданы нулевые записи об использовании источника (наглядно по [ссылке](https://docs.google.com/spreadsheets/d/1OCqHS_3V8NrL0InmuJwI5iZNZuefDYW5KyGE63CcZuc/edit?usp=sharing).
</br>
Критическая ошибка возникает при наличии двух дат в данных о сне, сведения об ошибке в bug_report_2 по [ссылке](https://docs.google.com/spreadsheets/d/1XHViJFz7W1MCVAGegx8Hy004AM46BhAUisDun0GOP1E/edit?usp=sharing).
</br>
Незначительная ошибка возникает при наличии двух дат в данных о сне, сведения об ошибке в bug_report_3 по [ссылке](https://docs.google.com/spreadsheets/d/1XHViJFz7W1MCVAGegx8Hy004AM46BhAUisDun0GOP1E/edit?usp=sharing).




